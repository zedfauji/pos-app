<Page
    x:Class="MagiDesk.Frontend.Views.MenuManagementPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:local="using:MagiDesk.Frontend.Views"
    mc:Ignorable="d">
    
    <Page.Resources>
        <local:AvailabilityConverter x:Key="AvailabilityConverter"/>
        <DataTemplate x:Key="MenuItemTemplate">
            <Grid Width="200" Height="160">
                <Border CornerRadius="8" 
                        Padding="8" 
                        Background="{ThemeResource SolidBackgroundFillColorSecondary}"
                        BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                        BorderThickness="1"
                        CanDrag="True"
                        DragStarting="MenuItem_DragStarting">
                    <StackPanel Spacing="4">
                        <Border Height="80" 
                                Background="{ThemeResource ControlFillColorDefaultBrush}"
                                CornerRadius="4">
                            <FontIcon Glyph="&#xE8B9;" 
                                     FontSize="24"
                                     HorizontalAlignment="Center"
                                     VerticalAlignment="Center"
                                     Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                        </Border>
                        <TextBlock Text="{Binding Name}" 
                                   TextWrapping="Wrap" 
                                   FontWeight="SemiBold"/>
                        <TextBlock Text="{Binding Price}" 
                                   Foreground="{ThemeResource AccentTextFillColorPrimaryBrush}"/>
                        <TextBlock Text="{Binding Sku}" 
                                   FontSize="12" 
                                   Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                        <TextBlock Text="{Binding IsAvailable, Converter={StaticResource AvailabilityConverter}}" 
                                   FontSize="10" 
                                   HorizontalAlignment="Right"/>
                    </StackPanel>
                </Border>
            </Grid>
        </DataTemplate>
    </Page.Resources>
    
    <Grid Padding="12">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Header with Search and Filters -->
        <Grid Grid.Row="0" Margin="0,0,0,20">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>
            
            <!-- Title -->
            <StackPanel Grid.Row="0" Style="{StaticResource FluentPageHeaderStyle}">
                <TextBlock Text="Menu Management" Style="{StaticResource DisplayTextStyle}"/>
                <TextBlock Text="Organize and manage menu items by categories with advanced filtering" Style="{StaticResource CaptionTextStyle}" Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
            </StackPanel>

            <!-- Search and Filter Controls -->
            <Grid Grid.Row="1">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- Search Box -->
                <AutoSuggestBox Grid.Column="0" 
                                x:Name="SearchBox"
                                PlaceholderText="Search menu items..."
                                QuerySubmitted="SearchBox_QuerySubmitted"
                                TextChanged="SearchBox_TextChanged"
                                Margin="0,0,12,0"/>

                <!-- Category Filter -->
                <ComboBox Grid.Column="1" 
                          x:Name="CategoryFilter"
                          PlaceholderText="All Categories"
                          SelectionChanged="CategoryFilter_SelectionChanged"
                          Margin="0,0,12,0"
                          Width="200"/>

                <!-- Availability Filter -->
                <ComboBox Grid.Column="2" 
                          x:Name="AvailabilityFilter"
                          PlaceholderText="All Items"
                          SelectionChanged="AvailabilityFilter_SelectionChanged"
                          Margin="0,0,12,0"
                          Width="150">
                    <ComboBoxItem Content="All Items" Tag="All"/>
                    <ComboBoxItem Content="Available Only" Tag="Available"/>
                    <ComboBoxItem Content="Unavailable Only" Tag="Unavailable"/>
                </ComboBox>

                <!-- Sort Options -->
                <ComboBox Grid.Column="3" 
                          x:Name="SortOptions"
                          PlaceholderText="Sort by..."
                          SelectionChanged="SortOptions_SelectionChanged"
                          Margin="0,0,12,0"
                          Width="150">
                    <ComboBoxItem Content="Name A-Z" Tag="NameAsc"/>
                    <ComboBoxItem Content="Name Z-A" Tag="NameDesc"/>
                    <ComboBoxItem Content="Price Low-High" Tag="PriceAsc"/>
                    <ComboBoxItem Content="Price High-Low" Tag="PriceDesc"/>
                    <ComboBoxItem Content="Category" Tag="Category"/>
                </ComboBox>

                <!-- Refresh Button -->
                <Button Grid.Column="4" 
                        Content="Refresh" 
                        Click="RefreshMenuItems_Click"/>
            </Grid>
        </Grid>

        <!-- TabView for Menu Items and Modifiers -->
        <TabView Grid.Row="1" x:Name="MainTabView">
            <!-- Menu Items Tab -->
            <TabViewItem Header="Menu Items">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="8"/>
                        <ColumnDefinition Width="350"/>
                    </Grid.ColumnDefinitions>

                    <!-- Menu Items by Category -->
                    <ScrollViewer Grid.Column="0" x:Name="MenuItemsScrollViewer">
                        <StackPanel x:Name="CategoriesContainer" Spacing="24">
                            <!-- Categories will be dynamically generated here -->
                        </StackPanel>
                    </ScrollViewer>

                    <!-- Separator -->
                    <Border Grid.Column="1" 
                            Background="{ThemeResource ControlStrokeColorDefaultBrush}"/>

                    <!-- Enhanced Details Panel -->
                    <Grid Grid.Column="2" 
                          x:Name="MenuItemDetailsPanel"
                          Visibility="Collapsed">
                        <ScrollViewer>
                            <StackPanel Spacing="16">
                                <!-- Header -->
                                <StackPanel Spacing="8">
                                    <TextBlock Text="Menu Item Details" 
                                               FontSize="20" 
                                               FontWeight="SemiBold"/>
                                    <Border Height="2" 
                                            Background="{ThemeResource AccentTextFillColorPrimaryBrush}" 
                                            HorizontalAlignment="Left" 
                                            Width="60"/>
                                </StackPanel>
                                
                                <!-- Quick Actions -->
                                <StackPanel Orientation="Horizontal" Spacing="8">
                                    <Button Content="Edit" 
                                            Click="EditMenuItem_Click"
                                            x:Name="EditButton"
                                            Style="{StaticResource AccentButtonStyle}"/>
                                    <Button Content="Delete" 
                                            Click="DeleteMenuItem_Click"
                                            x:Name="DeleteButton"/>
                                    <Button Content="Toggle Availability" 
                                            Click="ToggleAvailability_Click"
                                            x:Name="ToggleAvailabilityButton"/>
                                </StackPanel>

                                <!-- Item Image -->
                                <Border Height="200" 
                                        Background="{ThemeResource ControlFillColorDefaultBrush}"
                                        CornerRadius="8"
                                        x:Name="ItemImageBorder">
                                    <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                                        <TextBlock Text="ðŸ“·" 
                                                   FontSize="48"
                                                   HorizontalAlignment="Center"/>
                                        <TextBlock Text="No Image" 
                                                   FontSize="12" 
                                                   Opacity="0.7"
                                                   HorizontalAlignment="Center"
                                                   Margin="0,8,0,0"/>
                                    </StackPanel>
                                </Border>
                                
                                <!-- Basic Info -->
                                <StackPanel Spacing="12">
                                    <TextBlock Text="Basic Information" 
                                               FontSize="16" 
                                               FontWeight="SemiBold"/>
                                    
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                        </Grid.RowDefinitions>

                                        <TextBlock Grid.Row="0" Grid.Column="0" Text="ID:" FontWeight="SemiBold" Margin="0,0,8,0"/>
                                        <TextBlock Grid.Row="0" Grid.Column="1" Text="{Binding SelectedMenuItem.MenuItemId}"/>
                                        
                                        <TextBlock Grid.Row="1" Grid.Column="0" Text="Name:" FontWeight="SemiBold" Margin="0,8,8,0"/>
                                        <TextBlock Grid.Row="1" Grid.Column="1" Text="{Binding SelectedMenuItem.Name}" TextWrapping="Wrap" Margin="0,8,0,0"/>
                                        
                                        <TextBlock Grid.Row="2" Grid.Column="0" Text="SKU:" FontWeight="SemiBold" Margin="0,8,8,0"/>
                                        <TextBlock Grid.Row="2" Grid.Column="1" Text="{Binding SelectedMenuItem.Sku}" Margin="0,8,0,0"/>
                                        
                                        <TextBlock Grid.Row="3" Grid.Column="0" Text="Price:" FontWeight="SemiBold" Margin="0,8,8,0"/>
                                        <TextBlock Grid.Row="3" Grid.Column="1" Text="{Binding SelectedMenuItem.Price}" 
                                                   Foreground="{ThemeResource AccentTextFillColorPrimaryBrush}" Margin="0,8,0,0"/>
                                        
                                        <TextBlock Grid.Row="4" Grid.Column="0" Text="Category:" FontWeight="SemiBold" Margin="0,8,8,0"/>
                                        <TextBlock Grid.Row="4" Grid.Column="1" Text="{Binding SelectedMenuItem.Category}" Margin="0,8,0,0"/>
                                    </Grid>
                                </StackPanel>

                                <!-- Status Flags -->
                                <StackPanel Spacing="12">
                                    <TextBlock Text="Status &amp; Properties" 
                                               FontSize="16" 
                                               FontWeight="SemiBold"/>
                                    
                                    <StackPanel Spacing="8">
                                        <CheckBox Content="Available for Sale" 
                                                  IsChecked="{Binding SelectedMenuItem.IsAvailable}" 
                                                  IsEnabled="False"/>
                                        <CheckBox Content="Can Apply Discounts" 
                                                  IsChecked="{Binding SelectedMenuItem.IsDiscountable}" 
                                                  IsEnabled="False"/>
                                        <CheckBox Content="Part of Combo Meals" 
                                                  IsChecked="{Binding SelectedMenuItem.IsPartOfCombo}" 
                                                  IsEnabled="False"/>
                                    </StackPanel>
                                </StackPanel>

                                <!-- Picture URL -->
                                <StackPanel Spacing="8">
                                    <TextBlock Text="Image URL" 
                                               FontSize="16" 
                                               FontWeight="SemiBold"/>
                                    <TextBlock Text="{Binding SelectedMenuItem.PictureUrl}" 
                                               TextWrapping="Wrap"
                                               FontSize="12"
                                               Opacity="0.7"/>
                                </StackPanel>
                            </StackPanel>
                        </ScrollViewer>
                    </Grid>
                </Grid>
            </TabViewItem>

            <!-- Modifiers Tab -->
            <TabViewItem Header="Modifiers">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="2*"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <!-- Modifiers List -->
                    <StackPanel Grid.Column="0" Margin="0,0,20,0">
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,16">
                            <TextBlock Text="Modifiers" FontSize="20" FontWeight="SemiBold" VerticalAlignment="Center"/>
                            <Button Content="Add Modifier" 
                                    Click="AddModifier_Click" 
                                    Margin="16,0,0,0"/>
                        </StackPanel>

                        <ListView x:Name="ModifiersListView" 
                                  ItemsSource="{Binding Modifiers}"
                                  SelectionChanged="ModifiersListView_SelectionChanged">
                            <ListView.ItemTemplate>
                                <DataTemplate>
                                    <Grid Padding="16" Margin="0,0,0,8" Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" CornerRadius="8">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>

                                        <StackPanel Grid.Column="0">
                                            <TextBlock Text="{Binding Name}" FontWeight="SemiBold" FontSize="16"/>
                                            <TextBlock Text="{Binding Description}" FontSize="12" Opacity="0.7" Margin="0,2,0,0"/>
                                            <StackPanel Orientation="Horizontal" Spacing="8" Margin="0,4,0,0">
                                                <TextBlock Text="{Binding OptionsCount}" FontSize="10" Opacity="0.5"/>
                                                <TextBlock Text="{Binding IsRequiredText}" FontSize="10" Opacity="0.5"/>
                                                <TextBlock Text="{Binding AllowMultipleText}" FontSize="10" Opacity="0.5"/>
                                            </StackPanel>
                                        </StackPanel>

                                        <Button Grid.Column="1" 
                                                Content="Edit" 
                                                Click="EditModifier_Click" 
                                                Margin="8,0,0,0"/>
                                        <Button Grid.Column="2" 
                                                Content="Delete" 
                                                Click="DeleteModifier_Click" 
                                                Margin="8,0,0,0"/>
                                    </Grid>
                                </DataTemplate>
                            </ListView.ItemTemplate>
                        </ListView>
                    </StackPanel>

                    <!-- Modifier Details -->
                    <StackPanel Grid.Column="1" x:Name="ModifierDetailsPanel" Visibility="Collapsed">
                        <TextBlock Text="Modifier Details" FontSize="20" FontWeight="SemiBold" Margin="0,0,0,16"/>
                        
                        <StackPanel Spacing="12">
                            <StackPanel>
                                <TextBlock Text="Name" FontWeight="SemiBold" Margin="0,0,0,4"/>
                                <TextBox x:Name="ModifierNameTextBox"/>
                            </StackPanel>

                            <StackPanel>
                                <TextBlock Text="Description" FontWeight="SemiBold" Margin="0,0,0,4"/>
                                <TextBox x:Name="ModifierDescriptionTextBox" 
                                         AcceptsReturn="True"
                                         Height="60"/>
                            </StackPanel>

                            <CheckBox x:Name="IsRequiredCheckBox" 
                                      Content="Required"/>

                            <CheckBox x:Name="AllowMultipleCheckBox" 
                                      Content="Allow Multiple Selections"/>

                            <StackPanel x:Name="MaxSelectionsPanel" Visibility="Collapsed">
                                <TextBlock Text="Max Selections" FontWeight="SemiBold" Margin="0,0,0,4"/>
                                <NumberBox x:Name="MaxSelectionsNumberBox" 
                                           Minimum="1"
                                           Maximum="10"/>
                            </StackPanel>

                            <StackPanel Margin="0,16,0,0">
                                <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                                    <TextBlock Text="Options" FontWeight="SemiBold"/>
                                    <Button Content="Add Option" 
                                            Click="AddOption_Click" 
                                            Margin="16,0,0,0"/>
                                </StackPanel>

                                <ListView x:Name="OptionsListView" 
                                          Height="200">
                                    <ListView.ItemTemplate>
                                        <DataTemplate>
                                            <Grid Padding="8" Margin="0,0,0,4" Background="{ThemeResource CardBackgroundFillColorSecondaryBrush}" CornerRadius="4">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                </Grid.ColumnDefinitions>

                                                <StackPanel Grid.Column="0">
                                                    <TextBlock Text="{Binding Name}" FontWeight="SemiBold"/>
                                                    <TextBlock Text="{Binding PriceDelta}" FontSize="10" Opacity="0.7"/>
                                                </StackPanel>

                                                <Button Grid.Column="1" 
                                                        Content="Edit" 
                                                        Click="EditOption_Click" 
                                                        Margin="4,0,0,0"/>
                                                <Button Grid.Column="2" 
                                                        Content="Delete" 
                                                        Click="DeleteOption_Click" 
                                                        Margin="4,0,0,0"/>
                                            </Grid>
                                        </DataTemplate>
                                    </ListView.ItemTemplate>
                                </ListView>
                            </StackPanel>

                            <StackPanel Orientation="Horizontal" Margin="0,16,0,0">
                                <Button Content="Save" 
                                        Click="SaveModifier_Click" 
                                        Margin="0,0,8,0"/>
                                <Button Content="Cancel" 
                                        Click="CancelEdit_Click"/>
                            </StackPanel>
                        </StackPanel>
                    </StackPanel>
                </Grid>
            </TabViewItem>
        </TabView>
    </Grid>
</Page>