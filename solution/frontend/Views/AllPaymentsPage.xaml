<Page
    x:Class="MagiDesk.Frontend.Views.AllPaymentsPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:converters="using:MagiDesk.Frontend.Converters"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d">

    <Page.Resources>
        <converters:CurrencyConverter x:Key="CurrencyConverter"/>
        <converters:DateTimeConverter x:Key="DateTimeConverter"/>
        <converters:PaymentMethodToColorConverter x:Key="PaymentMethodToColorConverter"/>

        
        <!-- Local style overrides -->
        <Style x:Key="PrimaryButtonStyle" TargetType="Button" BasedOn="{StaticResource FluentPrimaryButtonStyle}"/>
        <Style x:Key="SecondaryButtonStyle" TargetType="Button" BasedOn="{StaticResource FluentSecondaryButtonStyle}"/>
        <Style x:Key="ProfessionalCardStyle" TargetType="Border" BasedOn="{StaticResource FluentCardStyle}">
            <Setter Property="CornerRadius" Value="8"/>
        </Style>
        
        <Style x:Key="MetricCardStyle" TargetType="Border">
            <Setter Property="Background" Value="{ThemeResource CardBackgroundFillColorDefaultBrush}"/>
            <Setter Property="CornerRadius" Value="12"/>
            <Setter Property="Padding" Value="20"/>
            <Setter Property="Margin" Value="0,0,12,0"/>
            <Setter Property="BorderBrush" Value="{ThemeResource ControlStrokeColorDefaultBrush}"/>
            <Setter Property="BorderThickness" Value="1"/>
        </Style>
        
        <Style x:Key="PaymentCardStyle" TargetType="Border">
            <Setter Property="Background" Value="{ThemeResource CardBackgroundFillColorDefaultBrush}"/>
            <Setter Property="CornerRadius" Value="12"/>
            <Setter Property="Padding" Value="20"/>
            <Setter Property="Margin" Value="0,0,0,12"/>
            <Setter Property="BorderBrush" Value="{ThemeResource ControlStrokeColorDefaultBrush}"/>
            <Setter Property="BorderThickness" Value="1"/>
        </Style>
        
        <!-- Professional Input Styles -->
        <Style x:Key="MetricTitleStyle" TargetType="TextBlock" BasedOn="{StaticResource SubtitleTextStyle}"/>
        <Style x:Key="MetricValueStyle" TargetType="TextBlock" BasedOn="{StaticResource DisplayTextStyle}"/>
        
        <Style x:Key="ProfessionalTextBoxStyle" TargetType="TextBox" BasedOn="{StaticResource FluentTextBoxStyle}">
            <Setter Property="CornerRadius" Value="8"/>
            <Setter Property="Padding" Value="16,12"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="BorderBrush" Value="{ThemeResource ControlStrokeColorDefaultBrush}"/>
        </Style>
        
        <Style x:Key="ProfessionalComboBoxStyle" TargetType="ComboBox" BasedOn="{StaticResource FluentComboBoxStyle}">
            <Setter Property="CornerRadius" Value="8"/>
            <Setter Property="Padding" Value="16,12"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="BorderBrush" Value="{ThemeResource ControlStrokeColorDefaultBrush}"/>
        </Style>
        
        <!-- Debug Panel Style -->
        <Style x:Key="DebugPanelStyle" TargetType="Border">
            <Setter Property="Background" Value="{ThemeResource SystemFillColorCautionBackground}"/>
            <Setter Property="CornerRadius" Value="8"/>
            <Setter Property="Padding" Value="16"/>
            <Setter Property="Margin" Value="0,0,0,16"/>
            <Setter Property="BorderBrush" Value="{ThemeResource SystemFillColorCaution}"/>
            <Setter Property="BorderThickness" Value="1"/>
        </Style>
        
        <!-- Loading Animation -->
        <Style x:Key="LoadingSpinnerStyle" TargetType="ProgressRing">
            <Setter Property="Width" Value="40"/>
            <Setter Property="Height" Value="40"/>
            <Setter Property="Foreground" Value="{ThemeResource AccentTextFillColorPrimaryBrush}"/>
        </Style>
        
        <!-- Enhanced Loading States -->
        <Style x:Key="LoadingOverlayStyle" TargetType="Border">
            <Setter Property="Background" Value="{ThemeResource CardBackgroundFillColorDefaultBrush}"/>
            <Setter Property="CornerRadius" Value="12"/>
            <Setter Property="Padding" Value="40"/>
            <Setter Property="HorizontalAlignment" Value="Center"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
            <Setter Property="BorderBrush" Value="{ThemeResource ControlStrokeColorDefaultBrush}"/>
            <Setter Property="BorderThickness" Value="1"/>
        </Style>
        
        <Style x:Key="LoadingTextStyle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="16"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Foreground" Value="{ThemeResource TextFillColorPrimaryBrush}"/>
            <Setter Property="HorizontalAlignment" Value="Center"/>
            <Setter Property="Margin" Value="0,16,0,0"/>
        </Style>
        
        <Style x:Key="SkeletonCardStyle" TargetType="Border">
            <Setter Property="Background" Value="{ThemeResource CardBackgroundFillColorDefaultBrush}"/>
            <Setter Property="CornerRadius" Value="12"/>
            <Setter Property="Padding" Value="20"/>
            <Setter Property="Margin" Value="0,0,0,16"/>
            <Setter Property="BorderBrush" Value="{ThemeResource ControlStrokeColorDefaultBrush}"/>
            <Setter Property="BorderThickness" Value="1"/>
        </Style>
        
        <Style x:Key="SkeletonLineStyle" TargetType="Border">
            <Setter Property="Background" Value="{ThemeResource ControlFillColorDefaultBrush}"/>
            <Setter Property="CornerRadius" Value="4"/>
            <Setter Property="Height" Value="16"/>
            <Setter Property="Margin" Value="0,0,0,8"/>
        </Style>
        
        <!-- Data Visualization Styles -->
        <Style x:Key="ProgressBarStyle" TargetType="ProgressBar">
            <Setter Property="Height" Value="8"/>
            <Setter Property="CornerRadius" Value="4"/>
            <Setter Property="Foreground" Value="{ThemeResource AccentTextFillColorPrimaryBrush}"/>
            <Setter Property="Background" Value="{ThemeResource ControlFillColorDefaultBrush}"/>
        </Style>
        
        <Style x:Key="ChartContainerStyle" TargetType="Border">
            <Setter Property="Background" Value="{ThemeResource CardBackgroundFillColorDefaultBrush}"/>
            <Setter Property="CornerRadius" Value="12"/>
            <Setter Property="Padding" Value="20"/>
            <Setter Property="Margin" Value="0,0,0,16"/>
            <Setter Property="BorderBrush" Value="{ThemeResource ControlStrokeColorDefaultBrush}"/>
            <Setter Property="BorderThickness" Value="1"/>
        </Style>
        
        <Style x:Key="TrendIndicatorStyle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Margin" Value="8,0,0,0"/>
        </Style>
    </Page.Resources>

    <Grid Background="{ThemeResource ApplicationPageBackgroundThemeBrush}">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Professional Header with Gradient -->
        <Border Grid.Row="0" Style="{StaticResource FluentCardStyle}" Margin="0,0,0,24">
            <Border.Background>
                <LinearGradientBrush StartPoint="0,0" EndPoint="1,0">
                    <GradientStop Color="#0078D4" Offset="0"/>
                    <GradientStop Color="#106EBE" Offset="1"/>
                </LinearGradientBrush>
            </Border.Background>
            <Border.CornerRadius>16</Border.CornerRadius>
            
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                
                <StackPanel Grid.Column="0">
                    <TextBlock Text="All Payments" Style="{StaticResource DisplayTextStyle}" Foreground="White"/>
                    <TextBlock Text="Complete payment history with advanced analytics and management tools" Style="{StaticResource CaptionTextStyle}" Foreground="White" Opacity="0.9"/>
        </StackPanel>

                <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="12">
                    <Button Click="RefreshButton_Click" Style="{StaticResource FluentSecondaryButtonStyle}" Background="White" Foreground="{ThemeResource AccentFillColorDefaultBrush}">
                        <StackPanel Orientation="Horizontal" Spacing="8">
                            <FontIcon Glyph="&#xE72C;" FontSize="16"/>
                            <TextBlock Text="Refresh"/>
                        </StackPanel>
                    </Button>
                    <Button Click="ExportButton_Click" Style="{StaticResource FluentSecondaryButtonStyle}" Background="White" Foreground="{ThemeResource AccentFillColorDefaultBrush}">
                        <StackPanel Orientation="Horizontal" Spacing="8">
                            <FontIcon Glyph="&#xE792;" FontSize="16"/>
                            <TextBlock Text="Export"/>
                        </StackPanel>
                    </Button>
                    <Button Click="BackToPayments_Click" Style="{StaticResource PrimaryButtonStyle}" Background="White" Foreground="{ThemeResource AccentFillColorDefaultBrush}">
                        <StackPanel Orientation="Horizontal" Spacing="8">
                            <FontIcon Glyph="&#xE72D;" FontSize="16"/>
                            <TextBlock Text="Back to Payments"/>
                        </StackPanel>
                    </Button>
            </StackPanel>
            </Grid>
        </Border>

        <!-- Professional Statistics Dashboard -->
        <Grid Grid.Row="1" Margin="0,0,0,24">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>
            
            <!-- Total Payments -->
            <Border Grid.Column="0" Style="{StaticResource MetricCardStyle}">
                <StackPanel>
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,12">
                        <Border Background="{ThemeResource AccentFillColorDefaultBrush}" CornerRadius="8" Padding="8" Margin="0,0,12,0">
                            <FontIcon Glyph="&#xE8A5;" FontSize="20" Foreground="White"/>
                        </Border>
                        <TextBlock Text="Total Payments" Style="{StaticResource MetricTitleStyle}" VerticalAlignment="Center"/>
                    </StackPanel>
                    <TextBlock Text="{x:Bind ViewModel.Payments.Count, Mode=OneWay}" Style="{StaticResource MetricValueStyle}"/>
                    <TextBlock Text="All transactions" FontSize="12" Foreground="{ThemeResource TextFillColorSecondaryBrush}" Margin="0,4,0,0"/>
                </StackPanel>
            </Border>
            
            <!-- Total Amount -->
            <Border Grid.Column="1" Style="{StaticResource MetricCardStyle}">
                <StackPanel>
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,12">
                        <Border Background="{ThemeResource SystemFillColorSuccessBrush}" CornerRadius="8" Padding="8" Margin="0,0,12,0">
                            <FontIcon Glyph="&#xE8A5;" FontSize="20" Foreground="White"/>
                        </Border>
                        <TextBlock Text="Total Amount" Style="{StaticResource MetricTitleStyle}" VerticalAlignment="Center"/>
                    </StackPanel>
                    <TextBlock Text="{x:Bind ViewModel.TotalAmount, Mode=OneWay, Converter={StaticResource CurrencyConverter}}" Style="{StaticResource MetricValueStyle}"/>
                    <TextBlock Text="Revenue generated" FontSize="12" Foreground="{ThemeResource TextFillColorSecondaryBrush}" Margin="0,4,0,0"/>
                </StackPanel>
            </Border>
            
            <!-- Cash Payments -->
            <Border Grid.Column="2" Style="{StaticResource MetricCardStyle}">
                <StackPanel>
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,12">
                        <Border Background="{ThemeResource SystemFillColorSuccessBrush}" CornerRadius="8" Padding="8" Margin="0,0,12,0">
                            <FontIcon Glyph="&#xE8A5;" FontSize="20" Foreground="White"/>
                        </Border>
                        <TextBlock Text="Cash Payments" Style="{StaticResource MetricTitleStyle}" VerticalAlignment="Center"/>
                    </StackPanel>
                    <TextBlock Text="{x:Bind ViewModel.CashCount, Mode=OneWay}" Style="{StaticResource MetricValueStyle}"/>
                    <TextBlock Text="Cash transactions" FontSize="12" Foreground="{ThemeResource TextFillColorSecondaryBrush}" Margin="0,4,0,0"/>
                </StackPanel>
            </Border>
            
            <!-- Card Payments -->
            <Border Grid.Column="3" Style="{StaticResource MetricCardStyle}">
                <StackPanel>
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,12">
                        <Border Background="{ThemeResource AccentFillColorDefaultBrush}" CornerRadius="8" Padding="8" Margin="0,0,12,0">
                            <FontIcon Glyph="&#xE8A5;" FontSize="20" Foreground="White"/>
                        </Border>
                        <TextBlock Text="Card Payments" Style="{StaticResource MetricTitleStyle}" VerticalAlignment="Center"/>
                    </StackPanel>
                    <TextBlock Text="{x:Bind ViewModel.CardCount, Mode=OneWay}" Style="{StaticResource MetricValueStyle}"/>
                    <TextBlock Text="Card transactions" FontSize="12" Foreground="{ThemeResource TextFillColorSecondaryBrush}" Margin="0,4,0,0"/>
                </StackPanel>
            </Border>
            
            <!-- Average Amount -->
            <Border Grid.Column="4" Style="{StaticResource MetricCardStyle}" Margin="12,0,0,0">
                <StackPanel>
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,12">
                        <Border Background="{ThemeResource SystemFillColorAttentionBrush}" CornerRadius="8" Padding="8" Margin="0,0,12,0">
                            <FontIcon Glyph="&#xE8A5;" FontSize="20" Foreground="White"/>
                        </Border>
                        <TextBlock Text="Average Amount" Style="{StaticResource MetricTitleStyle}" VerticalAlignment="Center"/>
                    </StackPanel>
                    <TextBlock Text="{x:Bind ViewModel.AverageAmount, Mode=OneWay, Converter={StaticResource CurrencyConverter}}" Style="{StaticResource MetricValueStyle}"/>
                    <TextBlock Text="Per transaction" FontSize="12" Foreground="{ThemeResource TextFillColorSecondaryBrush}" Margin="0,4,0,0"/>
                </StackPanel>
            </Border>
        </Grid>

        <!-- Debug Info Panel -->
        <Border Grid.Row="2" Style="{StaticResource DebugPanelStyle}" Visibility="{x:Bind ViewModel.ShowDebugInfo, Mode=OneWay}">
            <StackPanel>
                <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                    <FontIcon Glyph="&#xE946;" FontSize="16" Foreground="{ThemeResource SystemFillColorCaution}"/>
                    <TextBlock Text="Debug Information" FontWeight="SemiBold" Margin="8,0,0,0" Foreground="{ThemeResource SystemFillColorCaution}"/>
                </StackPanel>
                <TextBlock Text="{x:Bind ViewModel.DebugInfo, Mode=OneWay}" FontFamily="Consolas" FontSize="12" Foreground="{ThemeResource TextFillColorPrimaryBrush}" TextWrapping="Wrap"/>
            </StackPanel>
        </Border>

        <!-- Professional Search and Filter Controls -->
        <Border Grid.Row="3" Style="{StaticResource FluentCardStyle}" Margin="0,0,0,24">
            <Grid>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>
            
                <TextBox x:Name="SearchBox" Grid.Column="0" 
                         PlaceholderText="Search by payment ID, method, or created by..." 
                         TextChanged="SearchBox_TextChanged" 
                         Style="{StaticResource ProfessionalTextBoxStyle}"
                         Margin="0,0,12,0"/>
                
                <ComboBox x:Name="PaymentMethodFilter" Grid.Column="1" 
                          PlaceholderText="Payment Method" 
                          SelectionChanged="PaymentMethodFilter_SelectionChanged" 
                          Style="{StaticResource ProfessionalComboBoxStyle}"
                          Width="160" Margin="0,0,12,0">
                <ComboBoxItem Content="All Methods" Tag=""/>
                    <ComboBoxItem Content="Cash" Tag="cash"/>
                    <ComboBoxItem Content="Card" Tag="card"/>
                    <ComboBoxItem Content="Digital" Tag="digital"/>
                    <ComboBoxItem Content="UPI" Tag="upi"/>
            </ComboBox>
            
                <ComboBox x:Name="DateRangeFilter" Grid.Column="2" 
                          PlaceholderText="Date Range" 
                          SelectionChanged="DateRangeFilter_SelectionChanged" 
                          Style="{StaticResource ProfessionalComboBoxStyle}"
                          Width="160" Margin="0,0,12,0">
                <ComboBoxItem Content="All Time" Tag=""/>
                <ComboBoxItem Content="Today" Tag="today"/>
                <ComboBoxItem Content="This Week" Tag="week"/>
                <ComboBoxItem Content="This Month" Tag="month"/>
                    <ComboBoxItem Content="Last 3 Months" Tag="quarter"/>
                </ComboBox>
                
                <ComboBox x:Name="AmountRangeFilter" Grid.Column="3" 
                          PlaceholderText="Amount Range" 
                          SelectionChanged="AmountRangeFilter_SelectionChanged" 
                          Style="{StaticResource ProfessionalComboBoxStyle}"
                          Width="160" Margin="0,0,12,0">
                    <ComboBoxItem Content="All Amounts" Tag=""/>
                    <ComboBoxItem Content="Under $50" Tag="under50"/>
                    <ComboBoxItem Content="$50 - $100" Tag="50-100"/>
                    <ComboBoxItem Content="$100 - $200" Tag="100-200"/>
                    <ComboBoxItem Content="Over $200" Tag="over200"/>
            </ComboBox>
                
                <Button Click="ClearFilters_Click" Style="{StaticResource FluentSecondaryButtonStyle}" Grid.Column="4">
                    <StackPanel Orientation="Horizontal" Spacing="6">
                        <FontIcon Glyph="&#xE711;" FontSize="14"/>
                        <TextBlock Text="Clear Filters"/>
                    </StackPanel>
                </Button>
        </Grid>
        </Border>
        
        <!-- Professional Payments List -->
        <ListView Grid.Row="4" x:Name="PaymentsListView" ItemsSource="{x:Bind ViewModel.FilteredPayments, Mode=OneWay}" SelectionMode="Single" Background="Transparent" ContainerContentChanging="PaymentsListView_ContainerContentChanging">
            <ListView.ItemTemplate>
                <DataTemplate>
                    <Border Style="{StaticResource PaymentCardStyle}">
                        <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        
                            <!-- Payment Information -->
                        <StackPanel Grid.Column="0">
                                <StackPanel Orientation="Horizontal" Margin="0,0,0,12">
                                    <Border Background="{Binding PaymentMethod, Converter={StaticResource PaymentMethodToColorConverter}}" CornerRadius="6" Padding="6" Margin="0,0,12,0">
                                        <FontIcon Glyph="&#xE8A5;" FontSize="16" Foreground="White"/>
                                    </Border>
                                    <StackPanel>
                                        <StackPanel Orientation="Horizontal" Spacing="8">
                                            <TextBlock Text="{Binding PaymentId}" FontWeight="SemiBold" FontSize="18" Foreground="{ThemeResource TextFillColorPrimaryBrush}"/>
                                            <Border x:Name="RefundStatusBadge" Background="{ThemeResource SystemFillColorAttentionBrush}" CornerRadius="4" Padding="6,2" Visibility="Collapsed">
                                                <TextBlock Text="Refunded" FontSize="10" FontWeight="SemiBold" Foreground="White"/>
                                            </Border>
                                        </StackPanel>
                                        <TextBlock Text="Payment ID" FontSize="12" Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                                    </StackPanel>
                                </StackPanel>
                                
                                <Grid Margin="0,0,0,8">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    
                                    <StackPanel Grid.Column="0" Margin="0,0,12,0">
                                        <StackPanel Orientation="Horizontal" Margin="0,0,0,4">
                                            <FontIcon Glyph="&#xE8A5;" FontSize="14" Foreground="{ThemeResource TextFillColorSecondaryBrush}" VerticalAlignment="Center"/>
                                            <TextBlock Text="{Binding PaymentMethod}" Foreground="{ThemeResource TextFillColorSecondaryBrush}" Margin="8,0,0,0" VerticalAlignment="Center"/>
                                        </StackPanel>
                                        <StackPanel Orientation="Horizontal">
                                            <FontIcon Glyph="&#xE716;" FontSize="14" Foreground="{ThemeResource TextFillColorSecondaryBrush}" VerticalAlignment="Center"/>
                                            <TextBlock Text="{Binding CreatedBy}" Foreground="{ThemeResource TextFillColorSecondaryBrush}" Margin="8,0,0,0" VerticalAlignment="Center"/>
                                        </StackPanel>
                                    </StackPanel>
                                    
                                    <StackPanel Grid.Column="1">
                                        <StackPanel Orientation="Horizontal" Margin="0,0,0,4">
                                            <FontIcon Glyph="&#xE121;" FontSize="14" Foreground="{ThemeResource TextFillColorSecondaryBrush}" VerticalAlignment="Center"/>
                                            <TextBlock Text="{Binding CreatedAt, Converter={StaticResource DateTimeConverter}}" Foreground="{ThemeResource TextFillColorSecondaryBrush}" FontSize="12" Margin="8,0,0,0" VerticalAlignment="Center"/>
                                        </StackPanel>
                                        <StackPanel Orientation="Horizontal">
                                            <FontIcon Glyph="&#xE8A5;" FontSize="14" Foreground="{ThemeResource TextFillColorSecondaryBrush}" VerticalAlignment="Center"/>
                                            <TextBlock Text="{Binding ExternalRef}" Foreground="{ThemeResource TextFillColorSecondaryBrush}" FontSize="12" Margin="8,0,0,0" VerticalAlignment="Center"/>
                                        </StackPanel>
                                    </StackPanel>
                                </Grid>
                        </StackPanel>
                        
                            <!-- Amount -->
                            <StackPanel Grid.Column="1" HorizontalAlignment="Right" Margin="0,0,20,0">
                                <TextBlock Text="{Binding AmountPaid, Converter={StaticResource CurrencyConverter}}" FontWeight="SemiBold" FontSize="24" HorizontalAlignment="Right" Foreground="{ThemeResource TextFillColorPrimaryBrush}"/>
                                <TextBlock Text="Amount Paid" FontSize="12" Foreground="{ThemeResource TextFillColorSecondaryBrush}" Margin="0,4,0,0" HorizontalAlignment="Right"/>
                        </StackPanel>

                            <!-- Action Buttons -->
                            <StackPanel Grid.Column="2" Orientation="Horizontal" Spacing="8">
                                <Button Click="ViewPaymentDetails_Click" Tag="{Binding}" Style="{StaticResource SecondaryButtonStyle}">
                                    <StackPanel Orientation="Horizontal" Spacing="6">
                                        <FontIcon Glyph="&#xE946;" FontSize="14"/>
                                        <TextBlock Text="Details"/>
                                    </StackPanel>
                                </Button>
                                <Button Click="ProcessRefund_Click" Tag="{Binding}" Style="{StaticResource FluentSecondaryButtonStyle}" Background="{ThemeResource SystemFillColorCriticalBrush}" Foreground="White">
                                    <StackPanel Orientation="Horizontal" Spacing="6">
                                        <FontIcon Glyph="&#xE72C;" FontSize="14"/>
                                        <TextBlock Text="Refund"/>
                                    </StackPanel>
                                </Button>
                                <Button Click="PrintReceipt_Click" Tag="{Binding}" Style="{StaticResource SecondaryButtonStyle}">
                                    <StackPanel Orientation="Horizontal" Spacing="6">
                                        <FontIcon Glyph="&#xE749;" FontSize="14"/>
                                        <TextBlock Text="Receipt"/>
                                    </StackPanel>
                                </Button>
                        </StackPanel>
                    </Grid>
                    </Border>
                </DataTemplate>
            </ListView.ItemTemplate>
        </ListView>

        <!-- Professional Loading Overlay -->
        <Grid x:Name="LoadingOverlay" Grid.RowSpan="5" Background="#80000000" Visibility="{x:Bind ViewModel.IsLoading, Mode=OneWay}">
            <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" CornerRadius="16" Padding="48" HorizontalAlignment="Center" VerticalAlignment="Center" BorderBrush="{ThemeResource ControlStrokeColorDefaultBrush}" BorderThickness="1">
            <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                    <ProgressRing IsActive="True" Width="64" Height="64" Foreground="{ThemeResource AccentFillColorDefaultBrush}"/>
                    <TextBlock Text="Loading payment history..." Margin="0,24,0,0" Foreground="{ThemeResource TextFillColorPrimaryBrush}" FontSize="16" FontWeight="Medium"/>
                    <TextBlock Text="Please wait while we fetch the latest data" Margin="0,8,0,0" Foreground="{ThemeResource TextFillColorSecondaryBrush}" FontSize="14"/>
            </StackPanel>
            </Border>
        </Grid>

        <!-- Professional Error Overlay -->
        <Grid x:Name="ErrorOverlay" Grid.RowSpan="5" Background="#80000000" Visibility="{x:Bind ViewModel.HasError, Mode=OneWay}">
            <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" CornerRadius="16" Padding="48" HorizontalAlignment="Center" VerticalAlignment="Center" BorderBrush="{ThemeResource ControlStrokeColorDefaultBrush}" BorderThickness="1">
            <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                    <Border Background="{ThemeResource SystemFillColorCriticalBrush}" CornerRadius="12" Padding="16" Margin="0,0,0,24">
                        <FontIcon Glyph="&#xE783;" FontSize="48" Foreground="White"/>
                    </Border>
                    <TextBlock Text="Unable to Load Data" FontSize="20" Foreground="{ThemeResource TextFillColorPrimaryBrush}" FontWeight="SemiBold" Margin="0,0,0,12"/>
                    <TextBlock Text="{x:Bind ViewModel.ErrorMessage, Mode=OneWay}" Margin="0,0,0,24" Foreground="{ThemeResource TextFillColorSecondaryBrush}" TextWrapping="Wrap" TextAlignment="Center" MaxWidth="400"/>
                    <Button Click="RefreshButton_Click" Style="{StaticResource PrimaryButtonStyle}">
                        <StackPanel Orientation="Horizontal" Spacing="8">
                            <FontIcon Glyph="&#xE72C;" FontSize="16"/>
                            <TextBlock Text="Try Again"/>
                        </StackPanel>
                    </Button>
            </StackPanel>
            </Border>
        </Grid>
    </Grid>
</Page>