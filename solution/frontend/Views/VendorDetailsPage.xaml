<Page
    x:Class="MagiDesk.Frontend.Views.VendorDetailsPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:converters="using:MagiDesk.Frontend.Converters"
    xmlns:viewmodels="using:MagiDesk.Frontend.ViewModels">
    <Page.Resources>
        <converters:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter"/>
    </Page.Resources>
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Header with Back Button, Vendor Name and Status -->
        <Border Grid.Row="0" 
                Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                Padding="16"
                Margin="0,0,0,12">
            <Grid ColumnDefinitions="Auto,*,Auto,Auto">
                <Button Grid.Column="0"
                        Content="â† Back"
                        Click="BackButton_Click"
                        Margin="0,0,16,0"
                        HorizontalAlignment="Left"/>
                <StackPanel Grid.Column="1">
                    <TextBlock x:Name="VendorNameText" 
                               FontSize="24" 
                               FontWeight="SemiBold"
                               Text="{x:Bind _vendor.Name, Mode=OneWay}"/>
                    <StackPanel Orientation="Horizontal" Spacing="8" Margin="0,4,0,0">
                        <Border CornerRadius="4" Padding="6,2">
                            <Border.Background>
                                <SolidColorBrush Color="{x:Bind _vendor.StatusColor, Mode=OneWay}"/>
                            </Border.Background>
                            <TextBlock Text="{x:Bind _vendor.StatusDisplay, Mode=OneWay}" 
                                       FontSize="10" 
                                       Foreground="White"/>
                        </Border>
                        <TextBlock Text="{x:Bind _vendor.ContactInfo, Mode=OneWay}" 
                                   FontSize="12" 
                                   Opacity="0.7"/>
                    </StackPanel>
                </StackPanel>
                <Button Grid.Column="2" 
                        Content="ðŸ”„ Refresh" 
                        Click="RefreshButton_Click"
                        Margin="0,0,8,0"
                        HorizontalAlignment="Right"/>
                <Button Grid.Column="3" 
                        Content="Edit" 
                        Click="EditButton_Click"
                        HorizontalAlignment="Right"/>
            </Grid>
        </Border>

        <!-- TabView for Details -->
        <TabView Grid.Row="1" x:Name="DetailsTabView" TabWidthMode="SizeToContent">
            <!-- Overview Tab -->
            <TabViewItem Header="Overview" Tag="OverviewTab">
                <ScrollViewer VerticalScrollMode="Auto" HorizontalScrollMode="Auto">
                    <StackPanel Spacing="16" Padding="16">
                        <!-- Basic Information -->
                        <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                                CornerRadius="4"
                                Padding="16">
                            <StackPanel Spacing="12">
                                <TextBlock Text="Basic Information" 
                                           FontSize="16" 
                                           FontWeight="SemiBold"/>
                                <Grid ColumnDefinitions="Auto,*" RowDefinitions="Auto,Auto,Auto,Auto,Auto">
                                    <TextBlock Grid.Column="0" Grid.Row="0" Text="Budget:" FontWeight="SemiBold" Margin="0,0,8,8"/>
                                    <TextBlock Grid.Column="1" Grid.Row="0" Text="{x:Bind _vendor.BudgetDisplay, Mode=OneWay}" Margin="0,0,0,8"/>
                                    
                                    <TextBlock Grid.Column="0" Grid.Row="1" Text="Reminder:" FontWeight="SemiBold" Margin="0,0,8,8" 
                                               Visibility="{x:Bind _vendor.ReminderVisibility, Mode=OneWay}"/>
                                    <TextBlock Grid.Column="1" Grid.Row="1" Text="{x:Bind _vendor.Reminder, Mode=OneWay}" 
                                               Margin="0,0,0,8"
                                               Visibility="{x:Bind _vendor.ReminderVisibility, Mode=OneWay}"/>
                                    
                                    <TextBlock Grid.Column="0" Grid.Row="2" Text="Created:" FontWeight="SemiBold" Margin="0,0,8,8"/>
                                    <TextBlock Grid.Column="1" Grid.Row="2" Text="{x:Bind _vendor.CreatedAtDisplay, Mode=OneWay}" Margin="0,0,0,8"/>
                                    
                                    <TextBlock Grid.Column="0" Grid.Row="3" Text="Last Updated:" FontWeight="SemiBold" Margin="0,0,8,8"/>
                                    <TextBlock Grid.Column="1" Grid.Row="3" Text="{x:Bind _vendor.UpdatedAtDisplay, Mode=OneWay}" Margin="0,0,0,8"/>
                                    
                                    <TextBlock Grid.Column="0" Grid.Row="4" Text="Notes:" FontWeight="SemiBold" Margin="0,0,8,0" 
                                               Visibility="{x:Bind _vendor.HasNotes, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}"/>
                                    <TextBlock Grid.Column="1" Grid.Row="4" Text="{x:Bind _vendor.Notes, Mode=OneWay}" 
                                               TextWrapping="Wrap"
                                               Visibility="{x:Bind _vendor.HasNotes, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}"/>
                                </Grid>
                            </StackPanel>
                        </Border>

                        <!-- Order Summary -->
                        <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                                CornerRadius="4"
                                Padding="16"
                                Visibility="{x:Bind _vendor.HasOrders, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}">
                            <StackPanel Spacing="12">
                                <TextBlock Text="Order Summary" 
                                           FontSize="16" 
                                           FontWeight="SemiBold"/>
                                <Grid ColumnDefinitions="*,*,*,*" RowDefinitions="Auto,Auto">
                                    <StackPanel Grid.Column="0" Grid.Row="0" Margin="0,0,8,8">
                                        <TextBlock Text="Total Orders" FontSize="11" Opacity="0.7"/>
                                        <TextBlock Text="{x:Bind _vendor.TotalOrders, Mode=OneWay}" 
                                                   FontSize="20" 
                                                   FontWeight="SemiBold"/>
                                    </StackPanel>
                                    <StackPanel Grid.Column="1" Grid.Row="0" Margin="8,0,8,8">
                                        <TextBlock Text="Pending" FontSize="11" Opacity="0.7"/>
                                        <TextBlock Text="{x:Bind _vendor.PendingOrders, Mode=OneWay}" 
                                                   FontSize="20" 
                                                   FontWeight="SemiBold"
                                                   Foreground="{ThemeResource SystemAccentColor}"/>
                                    </StackPanel>
                                    <StackPanel Grid.Column="2" Grid.Row="0" Margin="8,0,8,8">
                                        <TextBlock Text="Total Value" FontSize="11" Opacity="0.7"/>
                                        <TextBlock Text="{x:Bind _vendor.TotalOrderValueDisplay, Mode=OneWay}" 
                                                   FontSize="20" 
                                                   FontWeight="SemiBold"/>
                                    </StackPanel>
                                    <StackPanel Grid.Column="3" Grid.Row="0" Margin="8,0,0,8">
                                        <TextBlock Text="Last Order" FontSize="11" Opacity="0.7"/>
                                        <TextBlock Text="{x:Bind _vendor.LastOrderDateDisplay, Mode=OneWay}" 
                                                   FontSize="20" 
                                                   FontWeight="SemiBold"/>
                                    </StackPanel>
                                </Grid>
                            </StackPanel>
                        </Border>

                        <!-- Performance Metrics -->
                        <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                                CornerRadius="4"
                                Padding="16"
                                Visibility="{x:Bind _vendor.HasOrders, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}">
                            <StackPanel Spacing="12">
                                <TextBlock Text="Performance Metrics" 
                                           FontSize="16" 
                                           FontWeight="SemiBold"/>
                                <Grid ColumnDefinitions="*,*" RowDefinitions="Auto,Auto">
                                    <StackPanel Grid.Column="0" Grid.Row="0" Margin="0,0,8,8">
                                        <TextBlock Text="On-Time Delivery Rate" FontSize="11" Opacity="0.7"/>
                                        <TextBlock Text="{x:Bind _vendor.OnTimeDeliveryRateDisplay, Mode=OneWay}" 
                                                   FontSize="18" 
                                                   FontWeight="SemiBold"
                                                   Foreground="{ThemeResource SystemAccentColor}"/>
                                    </StackPanel>
                                    <StackPanel Grid.Column="1" Grid.Row="0" Margin="8,0,0,8">
                                        <TextBlock Text="Average Delivery Days" FontSize="11" Opacity="0.7"/>
                                        <TextBlock Text="{x:Bind _vendor.AverageDeliveryDaysDisplay, Mode=OneWay}" 
                                                   FontSize="18" 
                                                   FontWeight="SemiBold"/>
                                    </StackPanel>
                                    <StackPanel Grid.Column="0" Grid.Row="1" Margin="0,8,8,0">
                                        <TextBlock Text="Monthly Spend" FontSize="11" Opacity="0.7"/>
                                        <TextBlock Text="{x:Bind _vendor.MonthlySpendDisplay, Mode=OneWay}" 
                                                   FontSize="18" 
                                                   FontWeight="SemiBold"/>
                                    </StackPanel>
                                    <StackPanel Grid.Column="1" Grid.Row="1" Margin="8,8,0,0">
                                        <TextBlock Text="Orders This Month" FontSize="11" Opacity="0.7"/>
                                        <TextBlock Text="{x:Bind _vendor.OrdersThisMonth, Mode=OneWay}" 
                                                   FontSize="18" 
                                                   FontWeight="SemiBold"/>
                                    </StackPanel>
                                </Grid>
                            </StackPanel>
                        </Border>
                    </StackPanel>
                </ScrollViewer>
            </TabViewItem>

            <!-- Items Tab -->
            <TabViewItem Header="Items" Tag="ItemsTab">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>
                    
                    <!-- Items Toolbar -->
                    <Border Grid.Row="0" 
                            Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                            Padding="12"
                            Margin="0,0,0,8">
                        <Grid ColumnDefinitions="*,Auto,Auto,Auto">
                            <TextBox x:Name="ItemsSearchBox"
                                     PlaceholderText="Search items by name or SKU..."
                                     TextChanged="ItemsSearchBox_TextChanged"
                                     Margin="0,0,8,0"/>
                            <ComboBox x:Name="ItemsSortComboBox"
                                      Grid.Column="1"
                                      Width="150"
                                      Margin="0,0,8,0"
                                      SelectionChanged="ItemsSortComboBox_SelectionChanged">
                                <ComboBoxItem Content="Name (A-Z)" Tag="NameAsc"/>
                                <ComboBoxItem Content="Name (Z-A)" Tag="NameDesc"/>
                                <ComboBoxItem Content="Price (Low-High)" Tag="PriceAsc"/>
                                <ComboBoxItem Content="Price (High-Low)" Tag="PriceDesc"/>
                                <ComboBoxItem Content="Stock (Low-High)" Tag="StockAsc"/>
                                <ComboBoxItem Content="Stock (High-Low)" Tag="StockDesc"/>
                            </ComboBox>
                            <Button Grid.Column="2"
                                    Content="âž• Add Item"
                                    Click="AddItem_Click"
                                    Margin="0,0,8,0"
                                    Style="{StaticResource AccentButtonStyle}"/>
                            <TextBlock x:Name="ItemsCountText"
                                       Grid.Column="3"
                                       VerticalAlignment="Center"
                                       FontSize="12"
                                       Opacity="0.7"
                                       Text="0 items"/>
                        </Grid>
                    </Border>
                    
                    <ScrollViewer Grid.Row="1">
                        <StackPanel x:Name="ItemsContent" Spacing="12" Padding="16">
                            <TextBlock Text="Loading items..." 
                                       x:Name="ItemsLoadingText"
                                       HorizontalAlignment="Center"
                                       Margin="0,20"/>
                            <TextBlock Text="No items found for this vendor." 
                                       x:Name="ItemsEmptyText"
                                       HorizontalAlignment="Center"
                                       Margin="0,20"
                                       Visibility="Collapsed"/>
                        </StackPanel>
                    </ScrollViewer>
                </Grid>
            </TabViewItem>

            <!-- Orders Tab -->
            <TabViewItem Header="Orders" Tag="OrdersTab">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>
                    
                    <!-- Orders Toolbar -->
                    <Border Grid.Row="0" 
                            Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                            Padding="12"
                            Margin="0,0,0,8">
                        <Grid ColumnDefinitions="*,Auto,Auto,Auto">
                            <TextBox x:Name="OrdersSearchBox"
                                     PlaceholderText="Search orders by ID or status..."
                                     TextChanged="OrdersSearchBox_TextChanged"
                                     Margin="0,0,8,0"/>
                            <ComboBox x:Name="OrdersStatusFilterComboBox"
                                      Grid.Column="1"
                                      Width="120"
                                      Margin="0,0,8,0"
                                      SelectionChanged="OrdersStatusFilterComboBox_SelectionChanged">
                                <ComboBoxItem Content="All Status" Tag=""/>
                                <ComboBoxItem Content="Draft" Tag="Draft"/>
                                <ComboBoxItem Content="Sent" Tag="Sent"/>
                                <ComboBoxItem Content="Confirmed" Tag="Confirmed"/>
                                <ComboBoxItem Content="Shipped" Tag="Shipped"/>
                                <ComboBoxItem Content="Delivered" Tag="Delivered"/>
                                <ComboBoxItem Content="Cancelled" Tag="Cancelled"/>
                            </ComboBox>
                            <ComboBox x:Name="OrdersSortComboBox"
                                      Grid.Column="2"
                                      Width="150"
                                      Margin="0,0,8,0"
                                      SelectionChanged="OrdersSortComboBox_SelectionChanged">
                                <ComboBoxItem Content="Date (Newest)" Tag="DateDesc"/>
                                <ComboBoxItem Content="Date (Oldest)" Tag="DateAsc"/>
                                <ComboBoxItem Content="Value (High-Low)" Tag="ValueDesc"/>
                                <ComboBoxItem Content="Value (Low-High)" Tag="ValueAsc"/>
                                <ComboBoxItem Content="Status" Tag="Status"/>
                            </ComboBox>
                            <TextBlock x:Name="OrdersCountText"
                                       Grid.Column="3"
                                       VerticalAlignment="Center"
                                       FontSize="12"
                                       Opacity="0.7"
                                       Text="0 orders"/>
                        </Grid>
                    </Border>
                    
                    <ScrollViewer Grid.Row="1">
                        <StackPanel x:Name="OrdersContent" Spacing="12" Padding="16">
                            <TextBlock Text="Loading orders..." 
                                       x:Name="OrdersLoadingText"
                                       HorizontalAlignment="Center"
                                       Margin="0,20"/>
                            <TextBlock Text="No orders found for this vendor." 
                                       x:Name="OrdersEmptyText"
                                       HorizontalAlignment="Center"
                                       Margin="0,20"
                                       Visibility="Collapsed"/>
                        </StackPanel>
                    </ScrollViewer>
                </Grid>
            </TabViewItem>

            <!-- Analytics Tab -->
            <TabViewItem Header="Analytics" Tag="AnalyticsTab">
                <ScrollViewer>
                    <StackPanel x:Name="AnalyticsContent" Spacing="16" Padding="16">
                        <TextBlock Text="Loading analytics..." 
                                   x:Name="AnalyticsLoadingText"
                                   HorizontalAlignment="Center"
                                   Margin="0,20"/>
                        <TextBlock Text="No analytics data available." 
                                   x:Name="AnalyticsEmptyText"
                                   HorizontalAlignment="Center"
                                   Margin="0,20"
                                   Visibility="Collapsed"/>
                    </StackPanel>
                </ScrollViewer>
            </TabViewItem>
        </TabView>
    </Grid>
</Page>

