<?xml version="1.0" encoding="utf-8"?>
<Page
    x:Class="MagiDesk.Frontend.Views.CustomerManagementPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <StackPanel Grid.Row="0" Margin="24,20,24,0">
            <TextBlock Text="Customer Management" 
                       Style="{StaticResource TitleTextBlockStyle}"
                       Margin="0,0,0,8"/>
            <TextBlock Text="Manage customers, memberships, and wallet balances"
                       Style="{StaticResource BodyTextBlockStyle}"
                       Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
        </StackPanel>

        <!-- Search and Actions -->
        <Grid Grid.Row="1" Margin="24,20,24,16">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <AutoSuggestBox x:Name="CustomerSearchBox"
                            Grid.Column="0"
                            PlaceholderText="Search customers by name, phone, or email..."
                            QueryIcon="Find"
                            TextChanged="CustomerSearchBox_TextChanged"
                            SuggestionChosen="CustomerSearchBox_SuggestionChosen"
                            QuerySubmitted="CustomerSearchBox_QuerySubmitted"
                            Margin="0,0,12,0"/>

            <Button x:Name="AddCustomerButton"
                    Grid.Column="1"
                    Content="Add Customer"
                    Style="{StaticResource AccentButtonStyle}"
                    Click="AddCustomer_Click"
                    Margin="0,0,12,0">
                <Button.KeyboardAccelerators>
                    <KeyboardAccelerator Modifiers="Control" Key="N"/>
                </Button.KeyboardAccelerators>
            </Button>

            <Button x:Name="RefreshButton"
                    Grid.Column="2"
                    Content="Refresh"
                    Click="Refresh_Click">
                <Button.KeyboardAccelerators>
                    <KeyboardAccelerator Key="F5"/>
                </Button.KeyboardAccelerators>
            </Button>
        </Grid>

        <!-- Customer List -->
        <ScrollViewer Grid.Row="2" Margin="24,0,24,0">
            <ListView x:Name="CustomersListView"
                      SelectionMode="Single"
                      SelectionChanged="CustomersListView_SelectionChanged"
                      IsItemClickEnabled="True"
                      ItemClick="CustomersListView_ItemClick">
                <ListView.ItemTemplate>
                    <DataTemplate>
                        <Grid Margin="0,8,0,8">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="60"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>

                            <!-- Avatar -->
                            <PersonPicture Grid.Column="0"
                                           DisplayName="{Binding FullName}"
                                           ProfilePicture="{Binding PhotoUrl}"
                                           Width="48"
                                           Height="48"
                                           VerticalAlignment="Center"/>

                            <!-- Customer Info -->
                            <StackPanel Grid.Column="1" Margin="12,0,0,0" VerticalAlignment="Center">
                                <TextBlock Text="{Binding FullName}"
                                           Style="{StaticResource BodyStrongTextBlockStyle}"/>
                                <TextBlock Text="{Binding Phone}"
                                           Style="{StaticResource CaptionTextBlockStyle}"
                                           Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                                <TextBlock Text="{Binding Email}"
                                           Style="{StaticResource CaptionTextBlockStyle}"
                                           Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                                <StackPanel Orientation="Horizontal" Spacing="8" Margin="0,4,0,0">
                                    <Border Background="Gray"
                                            CornerRadius="12"
                                            Padding="8,2">
                                        <TextBlock Text="{Binding MembershipLevel.Name}"
                                                   Style="{StaticResource CaptionTextBlockStyle}"
                                                   Foreground="White"/>
                                    </Border>
                                    <TextBlock Style="{StaticResource CaptionTextBlockStyle}"
                                               Foreground="{ThemeResource AccentTextFillColorPrimaryBrush}">
                                        <Run Text="{Binding LoyaltyPoints}"/>
                                        <Run Text=" pts"/>
                                    </TextBlock>
                                </StackPanel>
                            </StackPanel>

                            <!-- Wallet Balance -->
                            <StackPanel Grid.Column="2" Margin="12,0,0,0" VerticalAlignment="Center">
                                <TextBlock Text="Wallet Balance"
                                           Style="{StaticResource CaptionTextBlockStyle}"
                                           Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                           HorizontalAlignment="Right"/>
                                <TextBlock Text="{Binding Wallet.Balance}"
                                           Style="{StaticResource BodyStrongTextBlockStyle}"
                                           Foreground="{ThemeResource SystemFillColorSuccessBrush}"
                                           HorizontalAlignment="Right"/>
                            </StackPanel>

                            <!-- Actions -->
                            <StackPanel Grid.Column="3" Orientation="Horizontal" Spacing="4" Margin="12,0,0,0" VerticalAlignment="Center">
                                <Button Content="Edit"
                                        Style="{ThemeResource DefaultButtonStyle}"
                                        Click="EditCustomer_Click"
                                        Tag="{Binding}"/>
                                <Button Content="Wallet"
                                        Style="{ThemeResource DefaultButtonStyle}"
                                        Click="ManageWallet_Click"
                                        Tag="{Binding}"/>
                                <DropDownButton Style="{ThemeResource DefaultButtonStyle}">
                                    <DropDownButton.Content>
                                        <FontIcon Glyph="&#xE712;" FontSize="14"/>
                                    </DropDownButton.Content>
                                    <DropDownButton.Flyout>
                                        <MenuFlyout>
                                            <MenuFlyoutItem Text="View Details" Click="ViewCustomer_Click" Tag="{Binding}"/>
                                            <MenuFlyoutItem Text="Transaction History" Click="ViewTransactions_Click" Tag="{Binding}"/>
                                            <MenuFlyoutSeparator/>
                                            <MenuFlyoutItem Text="Deactivate" Click="DeactivateCustomer_Click" Tag="{Binding}"/>
                                            <MenuFlyoutItem Text="Activate" Click="ActivateCustomer_Click" Tag="{Binding}"/>
                                        </MenuFlyout>
                                    </DropDownButton.Flyout>
                                </DropDownButton>
                            </StackPanel>
                        </Grid>
                    </DataTemplate>
                </ListView.ItemTemplate>
            </ListView>
        </ScrollViewer>

        <!-- Status Bar -->
        <Grid Grid.Row="3" Background="{ThemeResource LayerFillColorDefaultBrush}" Padding="24,12">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <TextBlock x:Name="StatusTextBlock"
                       Grid.Column="0"
                       Text="Ready"
                       Style="{StaticResource CaptionTextBlockStyle}"
                       VerticalAlignment="Center"/>

            <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="12">
                <TextBlock x:Name="CustomerCountTextBlock"
                           Text="0 customers"
                           Style="{StaticResource CaptionTextBlockStyle}"
                           VerticalAlignment="Center"/>
                <ProgressRing x:Name="LoadingRing"
                              Width="16"
                              Height="16"
                              IsActive="False"
                              Visibility="Collapsed"/>
            </StackPanel>
        </Grid>
    </Grid>
</Page>
