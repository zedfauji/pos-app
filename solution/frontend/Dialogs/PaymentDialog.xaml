<ContentDialog
    x:Class="MagiDesk.Frontend.Dialogs.PaymentDialog"
    x:Name="DialogRoot"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    mc:Ignorable="d"
    Title="Payment Processing"
    PrimaryButtonText="Confirm Payment"
    SecondaryButtonText="Cancel"
    CloseButtonText="Print Receipt"
    DefaultButton="Primary"
    PrimaryButtonClick="OnConfirm"
    CloseButtonClick="OnPrintProForma"
    Width="800"
    Height="700">
    
    <Grid Padding="24">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header Section -->
        <StackPanel Grid.Row="0" Spacing="12">
            <TextBlock Text="Payment Processing" FontSize="24" FontWeight="SemiBold" HorizontalAlignment="Center"/>
            
            <!-- Bill Summary Card -->
            <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" 
                    BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" 
                    BorderThickness="1" 
                    CornerRadius="8" 
                    Padding="16">
                <StackPanel Spacing="8">
                    <TextBlock Text="Bill Summary" FontSize="16" FontWeight="SemiBold"/>
                    
                    <!-- Bill Details -->
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>
                        
                        <TextBlock Grid.Row="0" Grid.Column="0" Text="Bill ID:" FontWeight="SemiBold"/>
                        <TextBlock Grid.Row="0" Grid.Column="1" Text="{Binding BillingId}" Margin="8,0,0,0"/>
                        <TextBlock Grid.Row="0" Grid.Column="2" Text="Total Due:" FontWeight="SemiBold" Margin="16,0,0,0"/>
                        <TextBlock Grid.Row="0" Grid.Column="3" Text="{Binding TotalDue}" Margin="8,0,0,0" FontSize="16" FontWeight="SemiBold" Foreground="{ThemeResource AccentTextFillColorPrimaryBrush}"/>
                        
                        <TextBlock Grid.Row="1" Grid.Column="0" Text="Items:" FontWeight="SemiBold"/>
                        <TextBlock Grid.Row="1" Grid.Column="1" Text="{Binding Items.Count}" Margin="8,0,0,0"/>
                        <TextBlock Grid.Row="1" Grid.Column="2" Text="Status:" FontWeight="SemiBold" Margin="16,0,0,0"/>
                        <TextBlock Grid.Row="1" Grid.Column="3" Text="Pending Payment" Margin="8,0,0,0" Foreground="{ThemeResource SystemAccentColor}"/>
                    </Grid>
                </StackPanel>
            </Border>
        </StackPanel>

        <!-- Main Content Section -->
        <ScrollViewer Grid.Row="1" VerticalScrollMode="Auto" HorizontalScrollMode="Disabled">
            <StackPanel Spacing="20">
                
                <!-- Order Items Section -->
                <StackPanel Spacing="12">
                    <TextBlock Text="Order Items" FontSize="18" FontWeight="SemiBold"/>
                    <Border Background="{ThemeResource CardBackgroundFillColorSecondaryBrush}" 
                            BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" 
                            BorderThickness="1" 
                            CornerRadius="6" 
                            Padding="12">
                        <ListView ItemsSource="{Binding Items}" MinHeight="120" MaxHeight="200">
                            <ListView.ItemTemplate>
                                <DataTemplate>
                                    <Grid Margin="0,4">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>
                                        
                                        <TextBlock Grid.Column="0" Text="{Binding Name}" FontWeight="SemiBold"/>
                                        <TextBlock Grid.Column="1" Text="x" HorizontalAlignment="Center" Margin="8,0"/>
                                        <TextBlock Grid.Column="2" Text="{Binding Quantity}" Width="40" HorizontalAlignment="Center"/>
                                        <TextBlock Grid.Column="3" Text="{Binding LineTotal}" HorizontalAlignment="Right" FontWeight="SemiBold" Margin="16,0,0,0"/>
                                    </Grid>
                                </DataTemplate>
                            </ListView.ItemTemplate>
                        </ListView>
                    </Border>
                </StackPanel>

                <!-- Payment Method Section -->
                <StackPanel Spacing="12">
                    <TextBlock Text="Payment Method" FontSize="18" FontWeight="SemiBold"/>
                    <Border Background="{ThemeResource CardBackgroundFillColorSecondaryBrush}" 
                            BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" 
                            BorderThickness="1" 
                            CornerRadius="6" 
                            Padding="16">
                        <StackPanel Spacing="16">
                            <!-- Payment Method Selection -->
                            <StackPanel Spacing="8">
                                <TextBlock Text="Select Payment Method" FontWeight="SemiBold"/>
                                <ComboBox Header="Payment Method" 
                                          ItemsSource="{Binding Methods}" 
                                          SelectedItem="{Binding SelectedMethod}" 
                                          Width="200" 
                                          HorizontalAlignment="Left"/>
                            </StackPanel>

                            <!-- Amount Input -->
                            <StackPanel Spacing="8">
                                <TextBlock Text="Payment Amount" FontWeight="SemiBold"/>
                                <NumberBox Header="Amount ($)" 
                                           Value="{Binding Amount, Mode=TwoWay}" 
                                           Width="200" 
                                           Minimum="0" 
                                           SmallChange="0.01" 
                                           LargeChange="1.00"
                                           HorizontalAlignment="Left"
                                           SpinButtonPlacementMode="Inline"/>
                            </StackPanel>
                        </StackPanel>
                    </Border>
                </StackPanel>

                <!-- Tip Section -->
                <StackPanel Spacing="12">
                    <TextBlock Text="Gratuity" FontSize="18" FontWeight="SemiBold"/>
                    <Border Background="{ThemeResource CardBackgroundFillColorSecondaryBrush}" 
                            BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" 
                            BorderThickness="1" 
                            CornerRadius="6" 
                            Padding="16">
                        <StackPanel Spacing="16">
                            <!-- Quick Tip Buttons -->
                            <StackPanel Spacing="8">
                                <TextBlock Text="Quick Tip Options" FontWeight="SemiBold"/>
                                <StackPanel Orientation="Horizontal" Spacing="12">
                                    <Button Content="10%" 
                                            Click="OnQuickTip" 
                                            Tag="10" 
                                            Width="80" 
                                            Height="40"
                                            Background="{ThemeResource SystemAccentColor}"
                                            Foreground="White"/>
                                    <Button Content="15%" 
                                            Click="OnQuickTip" 
                                            Tag="15" 
                                            Width="80" 
                                            Height="40"
                                            Background="{ThemeResource SystemAccentColor}"
                                            Foreground="White"/>
                                    <Button Content="20%" 
                                            Click="OnQuickTip" 
                                            Tag="20" 
                                            Width="80" 
                                            Height="40"
                                            Background="{ThemeResource SystemAccentColor}"
                                            Foreground="White"/>
                                    <Button Content="Custom" 
                                            Click="OnCustomTip" 
                                            Width="80" 
                                            Height="40"
                                            Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                                            BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"/>
                                </StackPanel>
                            </StackPanel>

                            <!-- Custom Tip Input -->
                            <StackPanel Spacing="8">
                                <TextBlock Text="Custom Tip Amount" FontWeight="SemiBold"/>
                                <NumberBox x:Name="TipNumberBox"
                                           Header="Tip ($)" 
                                           Value="{Binding Tip, Mode=TwoWay}" 
                                           Width="200" 
                                           Minimum="0" 
                                           SmallChange="0.01" 
                                           LargeChange="1.00"
                                           HorizontalAlignment="Left"
                                           SpinButtonPlacementMode="Inline"/>
                            </StackPanel>
                        </StackPanel>
                    </Border>
                </StackPanel>

                <!-- Payment Summary Section -->
                <StackPanel Spacing="12">
                    <TextBlock Text="Payment Summary" FontSize="18" FontWeight="SemiBold"/>
                    <Border Background="{ThemeResource CardBackgroundFillColorSecondaryBrush}" 
                            BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" 
                            BorderThickness="1" 
                            CornerRadius="6" 
                            Padding="16">
                        <StackPanel Spacing="12">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>

                                <!-- Subtotal -->
                                <TextBlock Grid.Row="0" Grid.Column="0" Text="Subtotal:" FontWeight="SemiBold"/>
                                <TextBlock Grid.Row="0" Grid.Column="1" Text="{Binding TotalDue}" FontWeight="SemiBold"/>

                                <!-- Tip -->
                                <TextBlock Grid.Row="1" Grid.Column="0" Text="Tip:" FontWeight="SemiBold"/>
                                <TextBlock Grid.Row="1" Grid.Column="1" Text="{Binding Tip}" FontWeight="SemiBold"/>

                                <!-- Total -->
                                <Border Grid.Row="2" Grid.ColumnSpan="2" 
                                        Background="{ThemeResource SystemAccentColor}" 
                                        CornerRadius="4" 
                                        Padding="8" 
                                        Margin="0,8">
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>
                                        <TextBlock Grid.Column="0" Text="Total Amount:" FontWeight="Bold" Foreground="White"/>
                                        <TextBlock Grid.Column="1" Text="{Binding PaidText}" FontWeight="Bold" Foreground="White"/>
                                    </Grid>
                                </Border>

                                <!-- Change/Balance -->
                                <TextBlock Grid.Row="3" Grid.Column="0" Text="Change:" FontWeight="SemiBold" Margin="0,8,0,0"/>
                                <TextBlock Grid.Row="3" Grid.Column="1" Text="{Binding BalanceText}" FontWeight="SemiBold" Margin="0,8,0,0"/>

                                <!-- Debug Info (if needed) -->
                                <TextBlock Grid.Row="4" Grid.ColumnSpan="2" 
                                           Text="{Binding DebugInfo}" 
                                           Opacity="0.6" 
                                           FontSize="12" 
                                           Margin="0,8,0,0"/>
                            </Grid>
                        </StackPanel>
                    </Border>
                </StackPanel>

                <!-- Error Display -->
                <InfoBar IsOpen="{Binding HasError}" 
                         Severity="Error" 
                         Message="{Binding Error}"
                         IsClosable="True"/>

            </StackPanel>
        </ScrollViewer>

        <!-- Footer Section -->
        <StackPanel Grid.Row="2" Spacing="12" Margin="0,16,0,0">
            <!-- Action Buttons -->
            <StackPanel Orientation="Horizontal" Spacing="12" HorizontalAlignment="Right">
                <Button Content="Print Receipt" 
                        Click="OnPrintProFormaButton" 
                        Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                        BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                        Width="120"/>
                <Button Content="Export PDF" 
                        Click="OnExportReceiptPdf" 
                        Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                        BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                        Width="120"/>
            </StackPanel>
        </StackPanel>
    </Grid>
</ContentDialog>
