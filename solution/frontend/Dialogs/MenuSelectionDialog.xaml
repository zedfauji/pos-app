<ContentDialog
    x:Class="MagiDesk.Frontend.Dialogs.MenuSelectionDialog"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    Title="Add Items to Table"
    PrimaryButtonText="Add to Order"
    SecondaryButtonText="Cancel"
    CloseButtonText="Cancel"
    DefaultButton="Primary">

    <Grid MinWidth="800" MinHeight="600">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header with Table and Server Info -->
        <StackPanel Grid.Row="0" Margin="0,0,0,16">
            <TextBlock Text="Add Items to Order" FontSize="18" FontWeight="SemiBold" Margin="0,0,0,8"/>
            <StackPanel Orientation="Horizontal" Spacing="16">
                <StackPanel Orientation="Horizontal" Spacing="8">
                    <TextBlock Text="Table:" FontWeight="SemiBold"/>
                    <TextBlock Text="{Binding TableLabel}" FontWeight="SemiBold" Foreground="{ThemeResource SystemAccentColor}"/>
                </StackPanel>
                <StackPanel Orientation="Horizontal" Spacing="8">
                    <TextBlock Text="Server:" FontWeight="SemiBold"/>
                    <ComboBox x:Name="ServerComboBox" 
                              Width="150" 
                              ItemsSource="{Binding AvailableServers}"
                              SelectedItem="{Binding SelectedServer}"
                              DisplayMemberPath="Name"/>
                </StackPanel>
            </StackPanel>
        </StackPanel>

        <!-- Main Content Grid -->
        <Grid Grid.Row="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="2*"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <!-- Menu Items List -->
            <ListView Grid.Column="0" 
                      x:Name="MenuItemsListView"
                      ItemsSource="{Binding MenuItems}"
                      SelectionMode="Single"
                      Margin="0,0,8,0">
                <ListView.ItemTemplate>
                    <DataTemplate>
                        <Grid Padding="12" Margin="0,0,0,8" Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" CornerRadius="8">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>

                            <!-- Item Image -->
                            <Border Grid.Column="0" 
                                    Width="60" 
                                    Height="60" 
                                    Background="{ThemeResource SystemAccentColorLightBrush}" 
                                    CornerRadius="8"
                                    Margin="0,0,12,0">
                                <Image Source="{Binding PictureUrl}" 
                                       Stretch="UniformToFill"
                                       HorizontalAlignment="Center"
                                       VerticalAlignment="Center"/>
                            </Border>

                            <!-- Item Details -->
                            <StackPanel Grid.Column="1">
                                <TextBlock Text="{Binding Name}" FontWeight="SemiBold" FontSize="16"/>
                                <TextBlock Text="{Binding Description}" FontSize="12" Opacity="0.7" TextWrapping="Wrap" Margin="0,2,0,0"/>
                                <TextBlock Text="{Binding Category}" FontSize="10" Opacity="0.5" Margin="0,2,0,0"/>
                                <StackPanel Orientation="Horizontal" Spacing="8" Margin="0,4,0,0">
                                    <TextBlock Text="{Binding PriceText}" FontWeight="SemiBold" Foreground="{ThemeResource SystemAccentColor}"/>
                                    <TextBlock Text="{Binding SKU}" FontSize="10" Opacity="0.5"/>
                                </StackPanel>
                                <TextBlock Text="Customizable" 
                                           FontSize="10" 
                                           Foreground="{ThemeResource SystemAccentColor}" 
                                           Margin="0,2,0,0"
                                           Visibility="{Binding HasModifiers, Converter={StaticResource BoolToVisibilityConverter}}"/>
                            </StackPanel>

                            <!-- Quantity Controls -->
                            <StackPanel Grid.Column="2" Orientation="Horizontal" Spacing="4" VerticalAlignment="Center" Margin="8,0,0,0">
                                <Button Content="-" Click="QuantityMinus_Click" Width="24" Height="24"/>
                                <TextBlock Text="{Binding SelectedQuantity}" Width="32" TextAlignment="Center" VerticalAlignment="Center"/>
                                <Button Content="+" Click="QuantityPlus_Click" Width="24" Height="24"/>
                            </StackPanel>

                            <!-- Add Button -->
                            <StackPanel Grid.Column="3" Orientation="Horizontal" Spacing="4" VerticalAlignment="Center" Margin="8,0,0,0">
                                <Button Content="Customize" 
                                        Click="CustomizeItem_Click" 
                                        VerticalAlignment="Center"
                                        Visibility="{Binding HasModifiers, Converter={StaticResource BoolToVisibilityConverter}}"/>
                                <Button Content="Add" 
                                        Click="AddItem_Click" 
                                        VerticalAlignment="Center"
                                        IsEnabled="{Binding CanAdd}"/>
                            </StackPanel>
                        </Grid>
                    </DataTemplate>
                </ListView.ItemTemplate>
            </ListView>

            <!-- Selected Items and Customization -->
            <StackPanel Grid.Column="1" Spacing="8">
                <TextBlock Text="Selected Items" FontWeight="SemiBold" FontSize="14"/>
                <ListView x:Name="SelectedItemsListView" 
                          ItemsSource="{Binding SelectedItems}"
                          Height="300">
                    <ListView.ItemTemplate>
                        <DataTemplate>
                            <Grid Padding="8">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                
                                <StackPanel Grid.Column="0">
                                    <TextBlock Text="{Binding Name}" FontWeight="SemiBold"/>
                                    <TextBlock Text="{Binding CustomizationsText}" FontSize="10" Opacity="0.7"/>
                                    <TextBlock Text="{Binding QuantityText}" FontSize="10" Opacity="0.7"/>
                                </StackPanel>
                                
                                <Button Grid.Column="1" 
                                        Content="Ã—" 
                                        Click="RemoveItem_Click" 
                                        Width="24" 
                                        Height="24"
                                        FontSize="12"/>
                            </Grid>
                        </DataTemplate>
                    </ListView.ItemTemplate>
                </ListView>

                <!-- Customization Panel -->
                <StackPanel x:Name="CustomizationPanel" Visibility="Collapsed" Margin="0,8,0,0">
                    <TextBlock Text="Customize Item" FontWeight="SemiBold" FontSize="14" Margin="0,0,0,8"/>
                    <ScrollViewer Height="200" VerticalScrollBarVisibility="Auto">
                        <ItemsControl x:Name="ModifiersItemsControl">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <StackPanel Margin="0,0,0,12">
                                        <TextBlock Text="{Binding DisplayName}" FontWeight="SemiBold" FontSize="12"/>
                                        <ItemsControl ItemsSource="{Binding Options}" Margin="8,4,0,0">
                                            <ItemsControl.ItemTemplate>
                                                <DataTemplate>
                                                    <CheckBox Content="{Binding DisplayName}" 
                                                              Margin="0,2,0,0"
                                                              Click="ModifierOption_Click"/>
                                                </DataTemplate>
                                            </ItemsControl.ItemTemplate>
                                        </ItemsControl>
                                    </StackPanel>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </ScrollViewer>
                </StackPanel>

                <!-- Order Summary -->
                <StackPanel Margin="0,8,0,0">
                    <TextBlock Text="Order Summary" FontWeight="SemiBold" FontSize="14"/>
                    <TextBlock x:Name="ItemsCountText" FontSize="12"/>
                    <TextBlock x:Name="TotalAmountText" FontWeight="SemiBold" FontSize="14"/>
                </StackPanel>
            </StackPanel>
        </Grid>

        <!-- Footer Actions -->
        <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,16,0,0">
            <Button x:Name="AddToOrderButton" 
                    Content="Add to Order" 
                    Click="AddToOrder_Click" 
                    Margin="0,0,8,0"
                    IsEnabled="{Binding CanAddToOrder}"/>
            <Button Content="Cancel" 
                    Click="Cancel_Click" 
                    Margin="0,0,8,0"/>
        </StackPanel>
    </Grid>
</ContentDialog>
