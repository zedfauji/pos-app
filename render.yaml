# Render Blueprint for MagiDesk POS Migration
# GCP Cloud Run â†’ Render
# Services: 9 ASP.NET Core APIs + PostgreSQL Database

services:
  # TablesApi Service
  - type: web
    name: TablesApi
    runtime: docker
    plan: starter
    region: oregon
    dockerfilePath: src/Backend/TablesApi/Dockerfile
    dockerContext: .
    envVars:
      - key: ASPNETCORE_URLS
        value: http://0.0.0.0:10000
      - key: ASPNETCORE_ENVIRONMENT
        value: Production
      - key: ConnectionStrings__Postgres
        fromDatabase:
          name: magidesk-pos
          property: connectionString
    healthCheckPath: /health
    autoDeploy: true

  # OrderApi Service
  - type: web
    name: OrderApi
    runtime: docker
    plan: starter
    region: oregon
    dockerfilePath: src/Backend/OrderApi/Dockerfile
    dockerContext: .
    envVars:
      - key: ASPNETCORE_URLS
        value: http://0.0.0.0:10000
      - key: ASPNETCORE_ENVIRONMENT
        value: Production
      - key: ConnectionStrings__Postgres
        fromDatabase:
          name: magidesk-pos
          property: connectionString
    healthCheckPath: /health
    autoDeploy: true

  # PaymentApi Service
  - type: web
    name: PaymentApi
    runtime: docker
    plan: starter
    region: oregon
    dockerfilePath: src/Backend/PaymentApi/Dockerfile
    dockerContext: .
    envVars:
      - key: ASPNETCORE_URLS
        value: http://0.0.0.0:10000
      - key: ASPNETCORE_ENVIRONMENT
        value: Production
      - key: ConnectionStrings__Postgres
        fromDatabase:
          name: magidesk-pos
          property: connectionString
    healthCheckPath: /health
    autoDeploy: true

  # MenuApi Service
  - type: web
    name: MenuApi
    runtime: docker
    plan: starter
    region: oregon
    dockerfilePath: src/Backend/MenuApi/Dockerfile
    dockerContext: .
    envVars:
      - key: ASPNETCORE_URLS
        value: http://0.0.0.0:10000
      - key: ASPNETCORE_ENVIRONMENT
        value: Production
      - key: ConnectionStrings__Postgres
        fromDatabase:
          name: magidesk-pos
          property: connectionString
    healthCheckPath: /health
    autoDeploy: true

  # CustomerApi Service
  - type: web
    name: CustomerApi
    runtime: docker
    plan: starter
    region: oregon
    dockerfilePath: src/Backend/CustomerApi/Dockerfile
    dockerContext: .
    envVars:
      - key: ASPNETCORE_URLS
        value: http://0.0.0.0:10000
      - key: ASPNETCORE_ENVIRONMENT
        value: Production
      - key: ConnectionStrings__Postgres
        fromDatabase:
          name: magidesk-pos
          property: connectionString
    healthCheckPath: /health
    autoDeploy: true

  # DiscountApi Service
  - type: web
    name: DiscountApi
    runtime: docker
    plan: starter
    region: oregon
    dockerfilePath: src/Backend/DiscountApi/Dockerfile
    dockerContext: .
    envVars:
      - key: ASPNETCORE_URLS
        value: http://0.0.0.0:10000
      - key: ASPNETCORE_ENVIRONMENT
        value: Production
      - key: ConnectionStrings__Postgres
        fromDatabase:
          name: magidesk-pos
          property: connectionString
    healthCheckPath: /health
    autoDeploy: true

  # InventoryApi Service
  - type: web
    name: InventoryApi
    runtime: docker
    plan: starter
    region: oregon
    dockerfilePath: src/Backend/InventoryApi/Dockerfile
    dockerContext: .
    envVars:
      - key: ASPNETCORE_URLS
        value: http://0.0.0.0:10000
      - key: ASPNETCORE_ENVIRONMENT
        value: Production
      - key: ConnectionStrings__Postgres
        fromDatabase:
          name: magidesk-pos
          property: connectionString
    healthCheckPath: /health
    autoDeploy: true

  # SettingsApi Service
  - type: web
    name: SettingsApi
    runtime: docker
    plan: starter
    region: oregon
    dockerfilePath: src/Backend/SettingsApi/Dockerfile
    dockerContext: .
    envVars:
      - key: ASPNETCORE_URLS
        value: http://0.0.0.0:10000
      - key: ASPNETCORE_ENVIRONMENT
        value: Production
      - key: ConnectionStrings__Postgres
        fromDatabase:
          name: magidesk-pos
          property: connectionString
    healthCheckPath: /health
    autoDeploy: true

  # UsersApi Service
  - type: web
    name: UsersApi
    runtime: docker
    plan: starter
    region: oregon
    dockerfilePath: src/Backend/UsersApi/Dockerfile
    dockerContext: .
    envVars:
      - key: ASPNETCORE_URLS
        value: http://0.0.0.0:10000
      - key: ASPNETCORE_ENVIRONMENT
        value: Production
      - key: ConnectionStrings__Postgres
        fromDatabase:
          name: magidesk-pos
          property: connectionString
    healthCheckPath: /health
    autoDeploy: true

databases:
  # PostgreSQL Database
  - name: magidesk-pos
    databaseName: magideskdb
    plan: basic-1gb
    region: oregon
    postgresMajorVersion: 17
    ipAllowList: []  # Allow all IPs (configure as needed)
    # Note: PITR (Point-in-time recovery) is enabled by default on Render databases
    # Initial data import should be done via migration script

